<% layout('layout') %>
<div class="header">
    <div class="page-title">Tasks Inbox</div>
    <!-- Filter dropdowns removed -->
</div>
<div class="card">
    <div class="card-header">Tasks</div>
    <div class="card-body">
    <% if (typeof groupedTasks !== 'undefined' && Object.keys(groupedTasks).length) { %>
            <div class="company-task-cards" style="display:flex;flex-wrap:wrap;gap:1.2em;justify-content:center;">
            <% Object.keys(groupedTasks).forEach(function(companyId) { %>
                <div class="card company-task-card" style="flex:1 1 320px;max-width:480px;min-width:220px;margin-bottom:1.2em;">
                    <div class="card-header" style="font-weight:bold;font-size:1.1em;"> <%= groupedTasks[companyId].company_name %> </div>
                    <div class="card-body" style="background:#fff;padding:1.2em;border-radius:0 0 8px 8px;box-shadow:0 2px 8px rgba(0,0,0,0.04);">
                        <% groupedTasks[companyId].tasks.forEach(function(task) { %>
                            <div class="task-row" style="display:flex;flex-wrap:wrap;gap:0.7em;margin-bottom:0.7em;align-items:center;">
                                <span><strong>Task:</strong> <%= task.type %>
                                        <% if (task.type === 'email' && !(task.contact_email || task.company_email)) { %>
                                            (Find Email Manually)
                                        <% } %>
                                </span>
                                <% if (task.type === 'email') { %>
                                    <span>
                                        <%= task.contact_email || task.company_email || 'N/A' %>
                                    </span>
                                <% } else if (task.type === 'call') { %>
                                    <span>
                                        <%= task.contact_phone || task.company_phone || 'N/A' %>
                                    </span>
                                <% } else if (task.type === 'linkedin') { %>
                                    <span>
                                        <% if (task.contact_linkedin) { %>
                                            <a href="<%= task.contact_linkedin %>" target="_blank">LinkedIn</a>
                                        <% } else if (task.company_linkedin) { %>
                                            <a href="<%= task.company_linkedin %>" target="_blank">LinkedIn</a>
                                        <% } else { %>
                                            N/A
                                        <% } %>
                                    </span>
                                <% } %>
                                <span><strong>Owner:</strong> <%= task.company_name %></span>
                                <span><strong>Due:</strong> <%= task.due_date %></span>
                                <span><strong>Status:</strong> <%= task.status %></span>
                                <% if (task.status !== 'completed') { %>
                                    <form method="POST" action="/tasks/<%= task.id %>/complete" style="display:inline;">
                                        <button type="submit" class="btn btn-success btn-xs" style="padding:2px 8px;font-size:12px;">Mark as Completed</button>
                                    </form>
                                <% } %>
                            </div>
                        <% }) %>
                    </div>
                </div>
            <% }) %>
            </div>
<style>
@media (max-width: 768px) {
    .company-task-cards {
        flex-direction: column;
        gap: 1em;
    }
    .company-task-card {
        min-width: 0 !important;
        max-width: 100vw !important;
        margin-left: auto;
        margin-right: auto;
    }
    .card-header, .card-body {
        padding: 1em !important;
    }
    .task-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5em;
    }
}
</style>
        <% } else { %>
            <div>No tasks found.</div>
        <% } %>
    </div>
</div>
