<% layout('layout') %>
<div class="header">
    <div class="page-title">Tasks Inbox</div>
    <!-- Filter dropdowns removed -->
</div>
<div class="card">
    <div class="card-header">Tasks</div>
    <div class="card-body">
    <% if (typeof groupedTasks !== 'undefined' && Object.keys(groupedTasks).length) { %>
            <div class="company-task-cards">
            <% Object.keys(groupedTasks).forEach(function(companyId) { %>
                <div class="card company-task-card">
                    <div class="card-header" style="font-weight:bold;font-size:1.1em;">
                        <%= groupedTasks[companyId].company_name %>
                    </div>
                    <div class="card-body">
                        <% groupedTasks[companyId].tasks.forEach(function(task) { %>
                            <div class="task-row">
                                <span><strong>Task:</strong> <%= task.type %>
                                        <% if (task.type === 'email' && !(task.contact_email || task.company_email)) { %>
                                            (Find Email Manually)
                                        <% } %>
                                </span>
                                <% if (task.type === 'email') { %>
                                    <span>
                                        <%= task.contact_email || task.company_email || 'N/A' %>
                                    </span>
                                <% } else if (task.type === 'call') { %>
                                    <span>
                                        <%= task.contact_phone || task.company_phone || 'N/A' %>
                                    </span>
                                <% } else if (task.type === 'linkedin') { %>
                                    <span>
                                        <% if (task.contact_linkedin) { %>
                                            <a href="<%= task.contact_linkedin %>" target="_blank">LinkedIn</a>
                                        <% } else if (task.company_linkedin) { %>
                                            <a href="<%= task.company_linkedin %>" target="_blank">LinkedIn</a>
                                        <% } else { %>
                                            N/A
                                        <% } %>
                                    </span>
                                <% } %>
                                <span><strong>Owner:</strong> <%= task.company_name %></span>
                                <span><strong>Due:</strong> <%= task.due_date %></span>
                                <span><strong>Status:</strong> <%= task.status %></span>
                                <% if (task.status !== 'completed') { %>
                                    <form method="POST" action="/tasks/<%= task.id %>/complete" style="display:inline;">
                                        <button type="submit" class="btn btn-success btn-xs" style="padding:2px 8px;font-size:12px;">Mark as Completed</button>
                                    </form>
                                <% } %>
                            </div>
                        <% }) %>
                    </div>
                </div>
            <% }) %>
            </div>
        <% } else { %>
            <div>No tasks found.</div>
        <% } %>
    </div>
</div>
