<% layout('layout') %>
<div class="header">
    <div class="page-title">Workflows</div>
    <% if (user && user.role !== 'team-member') { %>
    <div class="header-actions">
        <a href="/workflows/new" class="btn btn-primary"><i class="fas fa-plus btn-icon"></i>New Workflow</a>
    </div>
    <% } %>
</div>
<div class="workflow-builder">
    <% workflows.forEach(function(wf) { %>
        <div class="card">
            <div class="card-header"><%= wf.name %></div>
            <div class="card-body">
                <ol>
                    <% wf.steps.forEach(function(step, idx) { %>
                        <li>
                            <strong>Step <%= idx+1 %>:</strong> <%= step.type %> (Delay: <%= step.delay_days %> days, Role: <%= step.role %>)<br>
                            <em>Template:</em> <%= step.template %>
                        </li>
                    <% }) %>
                </ol>
                                <% if (user && user.role !== 'team-member') { %>
                                <a href="/workflows/<%= wf.id %>/edit" class="btn btn-sm btn-secondary">Edit</a>
                                <form action="/workflows/<%= wf.id %>/delete" method="POST" style="display:inline;margin-left:0.5em;">
                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this workflow?');">Delete</button>
                                </form>
                                <% } %>
            </div>
        </div>
    <% }) %>
</div>
